import { Callout } from 'nextra/components'

# Querying Data of Existing Topics

> Worker nodes invoke this function to gather inferences during inference solicitation

## Querying Workers

There are workers today, mostly maintained by Allora Labs, that produce inferences for a set of [existing topics](/devs/get-started/existing-topics). They can be queried for inferences via standard Blockless function calls, which in turn can be used today in on-chain applications via [Allora consumer contracts](/devs/consumers/consumer-contracts/dev-consumers)). A Blockless function call can be submitted in a format like this:

```curl
curl --location 'https://heads.testnet-1.testnet.allora.network/api/v1/functions/execute' \
--header 'Content-Type: application/json' \
--data '{
    "function_id": "bafybeigpiwl3o73zvvl6dxdqu7zqcub5mhg65jiky2xqb4rdhfmikswzqm",
    "method": "allora-inference-function.wasm",
    "parameters": null,
    "topic": "1",
    "config": {
        "env_vars": [
            {
                "name": "BLS_REQUEST_PATH",
                "value": "/api"
            },
            {
                "name": "ALLORA_ARG_PARAMS",
                "value": "ETH"
            }
        ],
        "number_of_nodes": -1,
        "timeout": 2
    }
}'
```

Let's break down this request body:

- This request queries the index topic (topic `1`), on Allora Testnet, as specified by the head URL (https://heads.testnet-1.testnet.allora.network/api/v1/functions/execute).
- We specify the `function_id` and `method` fields to indicate that we want to solicit inferences in a particular way (this concerns the internals of the worker nodes). These values can be recovered by following [this step-by-step guide](/devs/workers/deploy-worker/build-and-deploy-worker-from-scratch).
- We pass in the input `ETH` to specify we want prices for Ethereum in particular, which is defined by the [`default_arg` of the topic](/devs/topic-creators/how-to-create-topic#creating-your-first-topic).
- `number_of_nodes: -1` indicates that we don't care how many nodes respond, so long as they respond to [roll call](https://blockless.network/docs/protocol/networking/execution#acquiring-the-execution-binary-pre-cache) within `timeout: 2` seconds of the request broadcast.

<Callout type="warning">
Inferences returned by the method above are considered [Unsafe Requests](/devs/consumers#unsafe-requests).
</Callout>

## Convenience Endpoint from Allora Labs (prev. Upshot)

To conveniently relay inferences from worker nodes to developers, Allora Labs has created an endpoint to solicit inferences from worker nodes and merge them into a format compatible with our consumers. The output of this endpoint can be passed directly as-is to our consumer. 

The `extra_data ` query parameter, where it is found, can be set to be any relevant argument of interest. `extra_data` is an arbitrary string that is hashed by our endpoint using `keccak256` so that it is compatible with the `extraData: bytes` field of [Allora consumer contracts](/devs/consumers/consumer-contracts/dev-consumers).

<Callout type="info">
Note that to use this endpoint you'll need an API key. To obtain an API key, you can create [an account here](https://developer.upshot.xyz).
</Callout>

To use this endpoint and obtain inferences, one can use the **topic-specific** curl request below. We'll show how to query for a specific topic ID, and break down the request so that you can build it for other topics of interest.

## ETH 10min Price Prediction

Request:

```curl
curl -X 'GET' 'https://api.upshot.xyz/v2/allora/consumer/arbitrum-42161?allora_topic_id=1&inference_value_type=uint256&extra_data=ETH' -H 'accept: application/json' -H 'x-api-key: UP-xxx' | jq
```

<Callout type="info">
Querying through this API is considered a safe request because it queries a signed request from the specified chain (e.g. `arbitrum-42161`). This chain signs the request for an Allora consumer contract, making the request safe even though it is off-chain.
</Callout>

Let's break down this request body:
- https://api.upshot.xyz/v2/allora/adapter/: The generic API request URL
- `arbitrum`: The chain to query the signed inference from
- `42161`: The chain ID to query the signed inference from
- `allora_topic_id=8`: The allora specific topic ID being queried
- `UP-xxx`: Replace this value with the specific API key you created on [Upshot](https://developer.upshot.xyz)
- `extra_data=ETH`: The [`default_arg`](/devs/topic-creators/how-to-create-topic) associated with the topic ID.

Example response:

```json
{
  "request_id": "0068b3a6-5380-487d-aa15-b53df0440a68",
  "status": true,
  "data": {
    "signature": "0xee00b2bf22f1ab7065c68d6d04788ce93552e01e10715a75974d2d36b0e200ac25257323b82cf6ebbd45c647abc88bb2a089c01e61d649822af7c91a8b091a621c",
    "numeric_data": {
      "topic_id": "8",
      "numeric_values": [
        "3455371037002390500000"
      ],
      "timestamp": 1721225187,
      "extra_data": "0xaaaebeba3810b1e6b70781f14b2d72c1cb89c0b2b320c43bb67ff79f562f5ff4"
    }
  }
}
```

